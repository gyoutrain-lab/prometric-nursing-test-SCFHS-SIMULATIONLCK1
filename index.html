<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SCFHS Pass Prediction Engine</title>
<style>
body { font-family: Arial, sans-serif; background: #f4f6f8; margin: 0; }
.container { max-width: 900px; margin: auto; background: #fff; padding: 20px; min-height: 100vh; }
h1, h2 { text-align: center; }
.hidden { display: none; }
input, button { padding: 10px; margin: 6px 0; width: 100%; font-size: 16px; }
#timer { text-align: center; font-weight: bold; font-size: 18px; margin-bottom: 10px; }
.option { border: 1px solid #ccc; padding: 10px; margin-top: 8px; cursor: pointer; }
.option:hover { background: #eef2f5; }
.option.selected { background: #d9e8ff; }
.option.correct { border-left: 6px solid green; }
.option.wrong { border-left: 6px solid red; }
.rationale { background: #f9fafb; border: 1px solid #ccc; padding: 15px; margin-top: 15px; }
.report { background: #f1f5f9; padding: 20px; margin-top: 20px; }
</style>
</head>

<body>
<div class="container">

<!-- REGISTRATION SCREEN -->
<div id="registerScreen">
  <h1>SCFHS Prometric CBT</h1>
  <input type="text" id="candidateName" placeholder="Full Name">
  <input type="text" id="candidateID" placeholder="Candidate ID">
  <input type="text" id="candidateEmail" placeholder="Email">
  <button onclick="registerCandidate()">Register & Start</button>
</div>

<!-- LOCKED SCREEN -->
<div id="lockedScreen" class="hidden">
  <h2>Exam Locked</h2>
  <p>This exam has already been used. Provider approval required to unlock.</p>
  <input type="text" id="approvalInput" placeholder="Provider Approval Code">
  <button onclick="unlockExam()">Unlock Exam</button>
</div>

<!-- EXAM SCREEN -->
<div id="examScreen" class="hidden">
  <h2 id="qCounter"></h2>
  <div id="timer">Time Remaining: 20:00</div>
  <p id="questionText"></p>
  <div id="options"></div>
  <button onclick="submitAnswer()">Submit Answer</button>
  <div id="rationaleBox" class="rationale hidden"></div>
  <button id="nextBtn" class="hidden" onclick="nextQuestion()">Next Question</button>
</div>

<!-- RESULT SCREEN -->
<div id="resultScreen" class="hidden">
  <h1>PASS PREDICTION RESULT</h1>
  <div id="finalReport" class="report"></div>
</div>

</div>

<script>
// ================= PROVIDER & CANDIDATE LOCK =================
const PROVIDER_CODE = "GYOUTRAIN-APPROVED";
let candidateKey = "";

// ================= QUESTIONS =================
const questions = [
{
  q: "A patient states, â€œI plan to kill myself tonight,â€ and has access to a firearm. What is the nurseâ€™s PRIORITY action?",
  options: [
    { text: "Ensure immediate safety and initiate involuntary hold procedures", tag: "SCFHS" },
    { text: "Respect the patientâ€™s confidentiality", tag: "SAFE_DELAY" },
    { text: "Encourage the patient to reconsider", tag: "NCLEX" },
    { text: "Document the statement and continue assessment", tag: "STR" }
  ],
  correctTag: "SCFHS",
  rationale: {
    correct: "Expressed suicidal intent with a lethal means represents imminent danger and requires immediate protective action.",
    distractors: {
      SAFE_DELAY: "SAFE-DELAY trap: Confidentiality never overrides immediate risk to life.",
      NCLEX: "NCLEX therapeutic trap: delays action, fails to prioritize safety.",
      STR: "STR documentation trap: documentation without intervention does not protect."
    }
  }
},
{
  q: "A patient with acute psychosis is pacing and threatening staff but has not attempted harm. What is the nurseâ€™s FIRST intervention?",
  options: [
    { text: "Use verbal de-escalation techniques", tag: "SCFHS" },
    { text: "Apply physical restraints immediately", tag: "SAFE_DELAY" },
    { text: "Administer PRN antipsychotic medication", tag: "NCLEX" },
    { text: "Call security to restrain the patient", tag: "STR" }
  ],
  correctTag: "SCFHS",
  rationale: {
    correct: "SCFHS prioritizes the least restrictive intervention before restraints or medication.",
    distractors: {
      SAFE_DELAY: "SAFE-DELAY trap: Restraints are last-resort.",
      NCLEX: "NCLEX trap: Medication-first bypasses de-escalation.",
      STR: "STR trap: Security escalates agitation."
    }
  }
},
{
  q: "A patient expresses passive death wishes but denies intent or plan. What is the nurseâ€™s BEST action?",
  options: [
    { text: "Conduct further suicide risk assessment", tag: "SCFHS" },
    { text: "Initiate involuntary hold immediately", tag: "SAFE_DELAY" },
    { text: "Dismiss the statement as attention-seeking", tag: "NCLEX" },
    { text: "Document and end the conversation", tag: "STR" }
  ],
  correctTag: "SCFHS",
  rationale: {
    correct: "When intent is unclear, SCFHS requires further structured risk assessment.",
    distractors: {
      SAFE_DELAY: "SAFE-DELAY trap: Hold requires imminent danger.",
      NCLEX: "NCLEX trap: Dismissal minimizes risk.",
      STR: "STR trap: Documentation prematurely ends assessment."
    }
  }
}
];

// ================= ENGINE =================
let shuffledQuestions = [];
let currentIndex = 0;
let selectedIndex = null;
let score = { SCFHS:0, NCLEX:0, STR:0, SAFE_DELAY:0 };

// ================= TIMER =================
let totalTime = 20*60;
let timeLeft = totalTime;
let timerInterval = null;

// ================= REGISTRATION =================
function registerCandidate(){
  const name = document.getElementById("candidateName").value.trim();
  const id = document.getElementById("candidateID").value.trim();
  const email = document.getElementById("candidateEmail").value.trim();
  
  if(!name || !id || !email){ alert("All fields are required"); return; }
  
  candidateKey = `SCFHS_LOCK_${id}_${email}`;
  
  if(localStorage.getItem(candidateKey)){
    document.getElementById("registerScreen").classList.add("hidden");
    document.getElementById("lockedScreen").classList.remove("hidden");
    return;
  }
  
  startExam();
}

// ================= UNLOCK =================
function unlockExam(){
  const code = document.getElementById("approvalInput").value.trim();
  if(code !== PROVIDER_CODE){ alert("Invalid approval code"); return; }
  localStorage.removeItem(candidateKey);
  startExam();
}

// ================= EXAM LOGIC =================
function startExam(){
  shuffledQuestions = shuffle(questions).map(q=>({...q, options:shuffle(q.options)}));
  document.getElementById("registerScreen").classList.add("hidden");
  document.getElementById("lockedScreen").classList.add("hidden");
  document.getElementById("examScreen").classList.remove("hidden");
  
  startTimer();
  loadQuestion();
}

function shuffle(arr){ return [...arr].sort(()=>Math.random()-0.5); }

function loadQuestion(){
  selectedIndex = null;
  document.getElementById("rationaleBox").classList.add("hidden");
  document.getElementById("nextBtn").classList.add("hidden");
  
  const q = shuffledQuestions[currentIndex];
  document.getElementById("qCounter").innerText = `Question ${currentIndex+1} of ${shuffledQuestions.length}`;
  document.getElementById("questionText").innerText = q.q;
  
  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";
  q.options.forEach((opt,i)=>{
    const div = document.createElement("div");
    div.className="option";
    div.innerText=opt.text;
    div.onclick=()=>selectOption(div,i);
    optionsDiv.appendChild(div);
  });
}

function selectOption(div,index){
  document.querySelectorAll(".option").forEach(o=>o.classList.remove("selected"));
  div.classList.add("selected");
  selectedIndex=index;
}

function submitAnswer(){
  if(selectedIndex===null){ alert("Select an option"); return; }
  const q = shuffledQuestions[currentIndex];
  const chosen = q.options[selectedIndex];
  const isCorrect = chosen.tag === q.correctTag;
  score[chosen.tag]++;
  
  document.querySelectorAll(".option").forEach((o,i)=>{
    if(q.options[i].tag===q.correctTag) o.classList.add("correct");
    if(i===selectedIndex && !isCorrect) o.classList.add("wrong");
  });
  
  const rationaleBox = document.getElementById("rationaleBox");
  rationaleBox.classList.remove("hidden");
  if(isCorrect){
    rationaleBox.innerHTML=`<b>Correct â€” SCFHS Decision</b><br><br>${q.rationale.correct}`;
  }else{
    rationaleBox.innerHTML=`<b>Incorrect â€” ${chosen.tag} Distractor</b><br><br>${q.rationale.distractors[chosen.tag]}<hr><b>SCFHS Rationale:</b><br>${q.rationale.correct}`;
  }
  
  document.getElementById("nextBtn").classList.remove("hidden");
}

function nextQuestion(){
  currentIndex++;
  currentIndex<shuffledQuestions.length?loadQuestion():showResult();
}

// ================= TIMER =================
function startTimer(){
  timeLeft=totalTime;
  updateTimer();
  timerInterval=setInterval(()=>{
    timeLeft--;
    if(timeLeft<=0){ clearInterval(timerInterval); autoEndExam(); }
    updateTimer();
  },1000);
}

function updateTimer(){
  const m=Math.floor(timeLeft/60);
  const s=timeLeft%60;
  document.getElementById("timer").innerText=`Time Remaining: ${m}:${s.toString().padStart(2,"0")}`;
}

function autoEndExam(){ if(selectedIndex!==null) submitAnswer(); setTimeout(showResult,600); }

function showResult(){
  clearInterval(timerInterval);
  document.getElementById("examScreen").classList.add("hidden");
  document.getElementById("resultScreen").classList.remove("hidden");
  
  const decision = score.SCFHS>=score.NCLEX && score.SCFHS>=score.STR ? "ðŸŸ¢ GO â€” SCFHS Ready":"ðŸ”´ NO-GO â€” Not SCFHS Ready";
  
  document.getElementById("finalReport").innerHTML=`
    <b>Decision:</b> ${decision}<br><br>
    <b>SCFHS Alignment:</b> ${score.SCFHS}<br>
    <b>NCLEX Bias:</b> ${score.NCLEX}<br>
    <b>STR Bias:</b> ${score.STR}<br>
    <b>Safe-Delay Bias:</b> ${score.SAFE_DELAY}
  `;
}
</script>
</body>
</html>
