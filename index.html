<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SCFHS Prometric CBT Exam</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f4f7;
  margin: 0;
}
.container {
  max-width: 900px;
  margin: 30px auto;
  background: #fff;
  padding: 25px;
  border-radius: 6px;
}
h1, h2 {
  text-align: center;
}
.hidden { display: none; }

input {
  width: 100%;
  padding: 10px;
  margin: 6px 0;
  font-size: 16px;
}

button {
  padding: 10px 16px;
  font-size: 16px;
  cursor: pointer;
  margin-top: 10px;
}

.timer {
  position: fixed;
  top: 15px;
  right: 20px;
  background: #111;
  color: #0f0;
  padding: 10px 15px;
  border-radius: 5px;
  font-size: 18px;
}

.option {
  margin: 8px 0;
}

.rationale {
  margin-top: 15px;
  padding: 12px;
  border-radius: 5px;
}
.correct {
  background: #e6f7e6;
  border-left: 5px solid green;
}
.incorrect {
  background: #fdeaea;
  border-left: 5px solid red;
}
.locked {
  color: red;
  text-align: center;
  font-weight: bold;
}
</style>
</head>

<body>

<div class="timer hidden" id="timer">60:00</div>

<!-- REGISTRATION -->
<div class="container" id="registerScreen">
<h1>SCFHS Prometric CBT</h1>
<input id="name" placeholder="Full Name">
<input id="uid" placeholder="ID Number">
<input id="email" placeholder="Email">
<button onclick="register()">Register & Start</button>
</div>

<!-- LOCKED SCREEN -->
<div class="container hidden" id="lockedScreen">
<h2 class="locked">EXAM LOCKED</h2>
<p style="text-align:center;">
This exam has already been used.<br>
Provider approval is required to re-open.
</p>
<input id="approvalCode" placeholder="Enter Provider Approval Code">
<button onclick="unlockExam()">Unlock Exam</button>
</div>

<!-- EXAM -->
<div class="container hidden" id="examScreen">
<h2 id="questionText"></h2>
<div id="options"></div>
<button onclick="submitAnswer()">Submit</button>
<div id="rationaleBox"></div>
<button class="hidden" id="nextBtn" onclick="nextQuestion()">Next</button>
</div>

<!-- END -->
<div class="container hidden" id="endScreen">
<h2>Exam Completed</h2>
<p>Your attempt has been recorded and locked.</p>
</div>

<script>
/* ================= CONFIG ================= */
const PROVIDER_CODE = "GYOUTRAIN-APPROVED";
const EXAM_TIME = 60 * 60;

/* ================= STATE ================= */
let timeLeft = EXAM_TIME;
let timerInterval;
let current = 0;

/* ================= QUESTIONS ================= */
const questions = [
{
q: "A patient develops hypotension, wheezing, and tachycardia immediately after IV antibiotic administration. What is the PRIORITY nursing action?",
options: [
"Stop the infusion immediately",
"Administer oral antihistamine",
"Document the adverse reaction",
"Reduce the infusion rate"
],
answer: 0,
rationales: [
"Correct. This is acute anaphylaxis. The FIRST action is stopping antigen exposure.",
"Incorrect. Oral antihistamines act too slowly in life-threatening reactions (NCLEX trap).",
"Incorrect. Documentation is secondary during an active emergency (STR priority trap).",
"Incorrect. Slowing still exposes the patient to the allergen (misleading safety trap)."
]
}
];

/* ================= LOGIC ================= */
function register() {
if (!name.value || !uid.value || !email.value) {
alert("All fields are required.");
return;
}

if (localStorage.getItem("SCFHS_LOCKED")) {
document.getElementById("registerScreen").classList.add("hidden");
document.getElementById("lockedScreen").classList.remove("hidden");
return;
}

startExam();
}

function unlockExam() {
if (approvalCode.value !== PROVIDER_CODE) {
alert("Invalid approval code.");
return;
}
localStorage.removeItem("SCFHS_LOCKED");
document.getElementById("lockedScreen").classList.add("hidden");
startExam();
}

function startExam() {
document.getElementById("registerScreen").classList.add("hidden");
document.getElementById("examScreen").classList.remove("hidden");
document.getElementById("timer").classList.remove("hidden");
startTimer();
loadQuestion();
}

function startTimer() {
timerInterval = setInterval(() => {
timeLeft--;
let m = Math.floor(timeLeft / 60);
let s = timeLeft % 60;
timer.innerText = `${m}:${s.toString().padStart(2,"0")}`;
if (timeLeft <= 0) endExam();
}, 1000);
}

function loadQuestion() {
let q = questions[current];
questionText.innerText = q.q;
options.innerHTML = "";
rationaleBox.innerHTML = "";
nextBtn.classList.add("hidden");

q.options.forEach((o,i)=>{
options.innerHTML += `
<div class="option">
<input type="radio" name="opt" value="${i}"> ${o}
</div>`;
});
}

function submitAnswer() {
let selected = document.querySelector('input[name="opt"]:checked');
if (!selected) return alert("Select an answer.");

let idx = selected.value;
let q = questions[current];

if (idx == q.answer) {
rationaleBox.innerHTML = `<div class="rationale correct">${q.rationales[idx]}</div>`;
} else {
rationaleBox.innerHTML = `<div class="rationale incorrect">${q.rationales[idx]}</div>`;
}
nextBtn.classList.remove("hidden");
}

function nextQuestion() {
current++;
if (current >= questions.length) endExam();
else loadQuestion();
}

function endExam() {
clearInterval(timerInterval);
localStorage.setItem("SCFHS_LOCKED", true);
document.getElementById("examScreen").classList.add("hidden");
document.getElementById("timer").classList.add("hidden");
document.getElementById("endScreen").classList.remove("hidden");
}
</script>

</body>
</html>
